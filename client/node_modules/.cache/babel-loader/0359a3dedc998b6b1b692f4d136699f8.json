{"ast":null,"code":"import _regeneratorRuntime from\"/home/andrew/webprogbase2/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _classCallCheck from\"/home/andrew/webprogbase2/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/andrew/webprogbase2/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"/home/andrew/webprogbase2/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"/home/andrew/webprogbase2/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _assertThisInitialized from\"/home/andrew/webprogbase2/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"/home/andrew/webprogbase2/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import React from'react';import axios from'axios';import'./css/user.css';var User=/*#__PURE__*/function(_React$Component){_inherits(User,_React$Component);function User(props){var _this;_classCallCheck(this,User);_this=_possibleConstructorReturn(this,_getPrototypeOf(User).call(this,props));_this.owner={};_this.state={cloudName:'hlrzutjus',unsignedUploadPreset:'lzhs5xdj',data:null,update:false,delete:false};_this.handleUpdate=_this.handleUpdate.bind(_assertThisInitialized(_this));_this.handleDelete=_this.handleDelete.bind(_assertThisInitialized(_this));_this.handleAdmin=_this.handleAdmin.bind(_assertThisInitialized(_this));_this.handleChange=_this.handleChange.bind(_assertThisInitialized(_this));_this.fullname=React.createRef();return _this;}_createClass(User,[{key:\"handleDelete\",value:function handleDelete(e){e.preventDefault();axios.delete('/api/v1/users/'+this.state.data._id,{headers:{Authorization:\"Bearer \".concat(this.props.auth)}}).then(this.props.history.push('/users')).catch(console.error);}},{key:\"handleUpdate\",value:function handleUpdate(e){var _this2=this;e.preventDefault();this.setState({update:false});axios.put('/api/v1/users/'+this.state.data._id,{fullname:this.fullname.current.value},{headers:{Authorization:\"Bearer \".concat(this.props.auth)}}).then(function(res){_this2.setState({data:res.data});}).catch(console.error);}},{key:\"handleAdmin\",value:function handleAdmin(e){var _this3=this;e.preventDefault();axios.put('/api/v1/users/'+this.state.data._id,{role:\"1\"},{headers:{Authorization:\"Bearer \".concat(this.props.auth)}}).then(function(res){_this3.setState({data:res.data});}).catch(console.error);}},{key:\"handleChange\",value:function handleChange(e){if(e.target.files[0]&&e.target.files[0].type.startsWith(\"image/\")){this.uploadFile(e.target.files[0]);}}},{key:\"uploadFile\",value:function uploadFile(file){var _this4=this;var url=\"https://api.cloudinary.com/v1_1/\".concat(this.state.cloudName,\"/upload\");var fd=new FormData();fd.append('file',file);fd.append('upload_preset',this.state.unsignedUploadPreset);fd.append('folder','avatars');axios.post(url,fd,{headers:{'Content-Type':'multipart/form-data'}}).then(function(res){return axios.put('/api/v1/users/'+_this4.state.data._id,{avaUrl:res.data.secure_url},{headers:{Authorization:\"Bearer \".concat(_this4.props.auth)}});}).then(function(res){return _this4.setState({data:res.data});}).catch(console.error);}},{key:\"componentDidMount\",value:function componentDidMount(){var me,id,res;return _regeneratorRuntime.async(function componentDidMount$(_context){while(1){switch(_context.prev=_context.next){case 0:if(this.state.data){_context.next=19;break;}_context.prev=1;if(!this.props.auth){_context.next=7;break;}_context.next=5;return _regeneratorRuntime.awrap(axios.get('/api/v1/me',{headers:{Authorization:\"Bearer \".concat(this.props.auth)}}));case 5:me=_context.sent;this.owner=me.data;case 7:id=this.props.match.params.id;if(!id){id=this.owner._id;};_context.next=12;return _regeneratorRuntime.awrap(axios.get('/api/v1/users/'+id,{headers:{Authorization:\"Bearer \".concat(this.props.auth)}}));case 12:res=_context.sent;this.setState({data:res.data});_context.next=19;break;case 16:_context.prev=16;_context.t0=_context[\"catch\"](1);console.error(_context.t0);case 19:case\"end\":return _context.stop();}}},null,this,[[1,16]]);}},{key:\"render\",value:function render(){var _this5=this;if(!this.state.data)return null;var check=this.state.data._id===this.owner._id;var admin=this.owner.role===1&&this.state.data.role!==1;return React.createElement(\"div\",{className:\"User\"},React.createElement(\"div\",{className:\"content\"},check&&React.createElement(\"span\",null,React.createElement(\"label\",{htmlFor:\"ava\",className:\"custom-file-upload\"},React.createElement(\"i\",{className:\"fa fa-user-circle\"}),\" Avatar\"),React.createElement(\"input\",{onChange:this.handleChange,name:\"ava\",type:\"file\",id:\"ava\",accept:\"image/*\"})),React.createElement(\"img\",{id:\"user\",src:this.state.data.avaUrl,alt:\"User avatar\"}),React.createElement(\"div\",{className:\"right\"},React.createElement(\"h2\",null,this.state.data.fullname),React.createElement(\"h3\",null,this.state.data.login),React.createElement(\"i\",null,this.state.data.registeredAt),React.createElement(\"h2\",null,\"Bio:\"),React.createElement(\"p\",null,\"Some text\"),React.createElement(\"p\",null,\"Some long text\"),React.createElement(\"p\",null,\"Some useless information about user\"),React.createElement(\"p\",null,\"Text text text text text text text text text text text text text text text\"),React.createElement(\"p\",null,\"Text text text text text text text text text text text text text text text\"),React.createElement(\"p\",null,\"Text text text text text text text text text text text text text text text\"),this.state.update&&React.createElement(\"div\",{id:\"update\",className:\"modal\"},React.createElement(\"form\",{className:\"modal-content animate\",onSubmit:this.handleUpdate,action:\"\",method:\"post\"},React.createElement(\"span\",{onClick:function onClick(){return _this5.setState({update:false});},className:\"close\",title:\"Close Modal\"},\"\\xD7\"),React.createElement(\"div\",{className:\"container\"},React.createElement(\"label\",{htmlFor:\"fullname\"},React.createElement(\"b\",null,\"Fullname\")),React.createElement(\"input\",{type:\"text\",placeholder:\"Enter fullname\",name:\"fullname\",defaultValue:this.state.data.fullname,ref:this.fullname,maxLength:\"50\"}),React.createElement(\"button\",{type:\"submit\",className:\"submit\"},\"Update\"),React.createElement(\"button\",{type:\"button\",onClick:function onClick(){return _this5.setState({update:false});},className:\"cancelbtn\"},\"Cancel\")))),this.state.delete&&React.createElement(\"div\",{id:\"delete\",className:\"modal\"},React.createElement(\"form\",{className:\"modal-content animate\",onSubmit:this.handleDelete,action:\"\",method:\"post\"},React.createElement(\"span\",{onClick:function onClick(){return _this5.setState({delete:false});},className:\"close\",title:\"Close Modal\"},\"\\xD7\"),React.createElement(\"div\",{className:\"container\"},React.createElement(\"img\",{src:\"../images/alert.png\",alt:\"alert\"}),React.createElement(\"h2\",null,\"Are you sure you wanna delete this user?\"),React.createElement(\"button\",{type:\"submit\",className:\"submit\"},\"Delete\"),React.createElement(\"button\",{type:\"button\",onClick:function onClick(){return _this5.setState({delete:false});},className:\"cancelbtn\"},\"Cancel\")))),admin&&React.createElement(\"span\",null,React.createElement(\"form\",{action:\"\",onSubmit:this.handleAdmin,method:\"get\"},React.createElement(\"button\",{className:\"btn\",type:\"submit\",name:\"role\"},React.createElement(\"i\",{class:\"fas fa-user-secret\"}),\" Admin\")),React.createElement(\"button\",{onClick:function onClick(){return _this5.setState({delete:true});},style:{width:\"auto\"}},React.createElement(\"i\",{className:\"fas fa-trash\"}),\" Delete\")),check&&React.createElement(\"span\",null,React.createElement(\"button\",{onClick:function onClick(){return _this5.setState({update:true});},style:{width:\"auto\"}},React.createElement(\"i\",{className:\"fas fa-video\"}),\" Update\"),React.createElement(\"button\",{onClick:function onClick(){return _this5.setState({delete:true});},style:{width:\"auto\"}},React.createElement(\"i\",{className:\"fas fa-trash\"}),\" Delete\")))));}}]);return User;}(React.Component);export default User;","map":{"version":3,"sources":["/home/andrew/webprogbase2/client/src/User.js"],"names":["React","axios","User","props","owner","state","cloudName","unsignedUploadPreset","data","update","delete","handleUpdate","bind","handleDelete","handleAdmin","handleChange","fullname","createRef","e","preventDefault","_id","headers","Authorization","auth","then","history","push","catch","console","error","setState","put","current","value","res","role","target","files","type","startsWith","uploadFile","file","url","fd","FormData","append","post","avaUrl","secure_url","get","me","id","match","params","check","admin","login","registeredAt","width","Component"],"mappings":"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","sourcesContent":["import React from 'react'\nimport axios from 'axios';\nimport './css/user.css'\n\nclass User extends React.Component {\n    owner = {}\n  constructor(props) {\n    super(props);\n    this.state = {\n        cloudName:'hlrzutjus',\n        unsignedUploadPreset:'lzhs5xdj',\n        data: null,\n        update: false,\n        delete: false\n    }\n    this.handleUpdate = this.handleUpdate.bind(this);\n    this.handleDelete = this.handleDelete.bind(this);\n    this.handleAdmin = this.handleAdmin.bind(this);\n    this.handleChange = this.handleChange.bind(this);\n    this.fullname = React.createRef()\n  }\n\n  handleDelete(e) {\n      e.preventDefault();\n      axios.delete('/api/v1/users/' + this.state.data._id, {headers:{Authorization: `Bearer ${this.props.auth}`}})\n      .then(this.props.history.push('/users'))\n      .catch(console.error)\n  }\n\n  handleUpdate(e) {\n      e.preventDefault();\n        this.setState({update: false})\n      axios.put('/api/v1/users/' + this.state.data._id,{fullname: this.fullname.current.value}, {headers:{Authorization: `Bearer ${this.props.auth}`}})\n      .then(res => {\n          this.setState({data: res.data});\n      })\n      .catch(console.error);\n  }\n\n  handleAdmin(e) {\n      e.preventDefault();\n      axios.put('/api/v1/users/' + this.state.data._id,{role: \"1\"}, {headers:{Authorization: `Bearer ${this.props.auth}`}})\n      .then(res => {\n        this.setState({data: res.data});\n      })\n      .catch(console.error);\n  }\n\n  handleChange(e) {\n      if(e.target.files[0] && e.target.files[0].type.startsWith(\"image/\")) {\n        this.uploadFile(e.target.files[0])\n      }\n  }\n\n  uploadFile(file) {\n    let url = `https://api.cloudinary.com/v1_1/${this.state.cloudName}/upload`;\n    let fd = new FormData();\n    fd.append('file', file);\n    fd.append('upload_preset', this.state.unsignedUploadPreset);\n    fd.append('folder', 'avatars');\n    axios.post(url, fd, {headers: {\n        'Content-Type': 'multipart/form-data'\n      }})\n      .then(res => {\n          return axios.put('/api/v1/users/' + this.state.data._id,{avaUrl: res.data.secure_url}, {headers:{Authorization: `Bearer ${this.props.auth}`}})\n      })\n      .then(res => this.setState({data: res.data}))\n      .catch(console.error);\n  }\n\n  async componentDidMount() {\n    if(!this.state.data) {\n        try {\n            if(this.props.auth) {\n                let me = await axios.get('/api/v1/me', {headers:{Authorization: `Bearer ${this.props.auth}`}});\n                this.owner = me.data;\n            }\n            let id = this.props.match.params.id;\n            if(!id) {id = this.owner._id};\n            let res = await axios.get('/api/v1/users/' + id, {headers:{Authorization: `Bearer ${this.props.auth}`}})\n            this.setState({data: res.data});\n        }\n        catch(err) {\n            console.error(err);\n        }\n    }\n  }\n\n  render() {\n    if(!this.state.data) return null;\n    const check = this.state.data._id === this.owner._id;\n    const admin = this.owner.role === 1 && this.state.data.role !== 1;\n    return (\n        <div className=\"User\">\n            <div className=\"content\">\n                {check &&\n                    <span>\n                        <label htmlFor=\"ava\" className=\"custom-file-upload\">\n                        <i className=\"fa fa-user-circle\"></i> Avatar\n                        </label>\n                        <input onChange={this.handleChange} name=\"ava\" type=\"file\" id=\"ava\" accept=\"image/*\"/>\n                    </span>\n                }\n                <img id=\"user\" src={this.state.data.avaUrl} alt=\"User avatar\"/>\n                <div className=\"right\">\n                    <h2>{this.state.data.fullname}</h2>\n                    <h3>{this.state.data.login}</h3>\n                    <i>{this.state.data.registeredAt}</i>\n                    <h2>Bio:</h2>\n                    <p>Some text</p>\n                    <p>Some long text</p>\n                    <p>Some useless information about user</p>\n                    <p>Text text text text text text text text text text text text text text text</p>\n                    <p>Text text text text text text text text text text text text text text text</p>\n                    <p>Text text text text text text text text text text text text text text text</p>\n\n                    {this.state.update &&\n                    <div id=\"update\" className=\"modal\">\n                    <form className=\"modal-content animate\" onSubmit={this.handleUpdate} action=\"\" method=\"post\">\n        \n                        <span onClick={() => this.setState({update: false})} className=\"close\" title=\"Close Modal\">&times;</span>\n        \n                        <div className=\"container\">\n                        <label htmlFor=\"fullname\"><b>Fullname</b></label>\n                        <input type=\"text\" placeholder=\"Enter fullname\" name=\"fullname\" defaultValue={this.state.data.fullname} ref={this.fullname} maxLength=\"50\" />\n        \n                        <button type=\"submit\" className=\"submit\">Update</button>\n                        <button type=\"button\" onClick={() => this.setState({update: false})} className=\"cancelbtn\">Cancel</button>\n                        </div>\n        \n                    </form>\n                    </div>\n                }\n                {this.state.delete &&\n                    <div id=\"delete\" className=\"modal\">\n                    <form className=\"modal-content animate\" onSubmit={this.handleDelete} action=\"\" method=\"post\">\n        \n                        <span onClick={() => this.setState({delete: false})} className=\"close\" title=\"Close Modal\">&times;</span>\n                        <div className=\"container\">\n                                <img src=\"../images/alert.png\" alt=\"alert\" />\n                                <h2>Are you sure you wanna delete this user?</h2>\n                                <button type=\"submit\" className=\"submit\">Delete</button>\n                                <button type=\"button\" onClick={() => this.setState({delete: false})} className=\"cancelbtn\">Cancel</button>\n                        </div>\n                    </form>\n                    </div>\n                }\n                {admin &&\n                    <span>\n                        <form action=\"\" onSubmit={this.handleAdmin} method=\"get\">\n                            <button className=\"btn\" type=\"submit\" name=\"role\"><i class=\"fas fa-user-secret\"></i> Admin</button>\n                        </form>\n                        <button onClick={() => this.setState({delete: true})} style={{width: \"auto\"}}><i className=\"fas fa-trash\"></i> Delete</button>\n                    </span>\n                }\n                {check &&\n                    <span>\n                        <button onClick={() => this.setState({update: true})} style={{width: \"auto\"}}><i className=\"fas fa-video\"></i> Update</button>\n                        <button onClick={() => this.setState({delete: true})} style={{width: \"auto\"}}><i className=\"fas fa-trash\"></i> Delete</button>\n                    </span>\n                }\n                </div>\n                </div>\n        </div>\n    );\n  }\n}\n\nexport default User"]},"metadata":{},"sourceType":"module"}