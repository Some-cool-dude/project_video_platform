{"ast":null,"code":"import _classCallCheck from\"/home/andrew/webprogbase2/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/andrew/webprogbase2/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"/home/andrew/webprogbase2/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"/home/andrew/webprogbase2/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _assertThisInitialized from\"/home/andrew/webprogbase2/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"/home/andrew/webprogbase2/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import React from'react';import axios from'axios';import'./css/new.css';var NewVideo=/*#__PURE__*/function(_React$Component){_inherits(NewVideo,_React$Component);function NewVideo(props){var _this;_classCallCheck(this,NewVideo);_this=_possibleConstructorReturn(this,_getPrototypeOf(NewVideo).call(this,props));_this.count=0;_this.url='';_this.format='';_this.state={cloudName:'hlrzutjus',unsignedUploadPreset:'lzhs5xdj',progress:0,progressText:'',error:false,message:''};_this.handleSubmit=_this.handleSubmit.bind(_assertThisInitialized(_this));_this.video=React.createRef();_this.poster=React.createRef();_this.title=React.createRef();_this.quality=React.createRef();_this.size=React.createRef();return _this;}_createClass(NewVideo,[{key:\"uploadFile\",value:function uploadFile(file){var _this2=this;this.count++;var url=\"https://api.cloudinary.com/v1_1/\".concat(this.state.cloudName,\"/upload\");var fd=new FormData();fd.append('file',file);fd.append('upload_preset',this.state.unsignedUploadPreset);if(this.count===1){fd.append('folder','videos');}else{fd.append('folder','posters');}axios.post(url,fd,{headers:{'Content-Type':'multipart/form-data'},onUploadProgress:function onUploadProgress(e){var progress=Math.round(e.loaded*100.0/e.total);if(_this2.count===1){_this2.setState({progress:progress,progressText:progress+\"% video\"});}else{_this2.setState({progress:progress,progressText:progress+\"% poster\"});}}}).then(function(res){if(_this2.count===1){console.log(res.data);_this2.url=res.data.secure_url;_this2.format=res.data.format;_this2.uploadFile(_this2.poster.current.files[0]);return false;}else{var obj={title:_this2.title.current.value};obj.posterUrl=res.data.secure_url;obj.format=_this2.format;obj.size=_this2.size.current.value;obj.quality=_this2.quality.current.value;obj.videoUrl=_this2.url;if(_this2.props.location.query){obj.ch=_this2.props.location.query.ch;}return axios.post('/api/v1/videos',obj,{headers:{Authorization:\"Bearer \".concat(_this2.props.auth)}});}}).then(function(res){if(res){_this2.props.history.push('/videos/'+res.data._id);}}).catch(function(err){if(err.response){if(err.response.status===401)return _this2.props.history.push('/401');else if(err.response.status===403)return _this2.props.history.push('/403');else if(err.response.status===404)return _this2.props.history.push('/404');}console.error(err);});}},{key:\"handleSubmit\",value:function handleSubmit(event){event.preventDefault();if(this.title.current.value===''||this.size.current.value===''||this.quality.current.value===''||!this.video.current.files[0]||!this.poster.current.files[0]){this.setState({error:true,message:'Please fill all fields'});}else if(this.title.current.value.length>50){this.setState({error:true,message:'Too long title'});}else if(!this.video.current.files[0].type.startsWith(\"video/\")||!this.poster.current.files[0].type.startsWith(\"image/\")){this.setState({error:true,message:'Wrong file type'});}else{this.uploadFile(this.video.current.files[0]);}}},{key:\"componentWillUnmount\",value:function componentWillUnmount(){this.count=0;this.url='';this.format='';}},{key:\"render\",value:function render(){if(!this.props.auth)this.props.history.push('/401');var progress=this.state.progress!==0;return React.createElement(\"div\",{className:\"New\"},this.state.error&&React.createElement(\"div\",{className:\"alert alert-danger\",id:\"alert\"},this.state.message),React.createElement(\"form\",{action:\"/videos/new\",method:\"POST\",encType:\"multipart/form-data\",id:\"form\",onSubmit:this.handleSubmit},React.createElement(\"div\",{className:\"line\"},React.createElement(\"div\",{className:\"col-25\"},React.createElement(\"label\",{htmlFor:\"title\"},\"Title:\")),React.createElement(\"div\",{className:\"col-75\"},React.createElement(\"input\",{type:\"text\",id:\"title\",name:\"title\",placeholder:\"Title..\",ref:this.title,required:true}))),React.createElement(\"div\",{className:\"line\"},React.createElement(\"div\",{className:\"col-25\"},React.createElement(\"label\",{htmlFor:\"quality\"},\"Quality:\")),React.createElement(\"div\",{className:\"col-75\"},React.createElement(\"input\",{type:\"number\",name:\"quality\",min:\"0\",ref:this.quality,id:\"quality\"}))),React.createElement(\"div\",{className:\"line\"},React.createElement(\"div\",{className:\"col-25\"},React.createElement(\"label\",{htmlFor:\"size\"},\"Size:\")),React.createElement(\"div\",{className:\"col-75\"},React.createElement(\"input\",{type:\"number\",name:\"size\",min:\"0\",ref:this.size,id:\"size\"}))),progress&&React.createElement(\"div\",{className:\"progress\"},React.createElement(\"div\",{id:\"progress\",className:\"progress-bar progress-bar-success progress-bar-striped\",role:\"progressbar\",\"aria-valuenow\":this.state.progress,\"aria-valuemin\":\"0\",\"aria-valuemax\":\"100\",style:{width:this.state.progress+'%'}},this.state.progressText)),React.createElement(\"div\",{className:\"line\"},React.createElement(\"div\",{className:\"col-50\"},React.createElement(\"div\",{className:\"col-md-6\"},React.createElement(\"div\",{className:\"form-group files\"},React.createElement(\"label\",null,\"Upload your video \"),React.createElement(\"input\",{type:\"file\",className:\"form-control\",name:\"video\",id:\"video\",accept:\"video/*\",ref:this.video,required:true})))),React.createElement(\"div\",{className:\"col-50\"},React.createElement(\"div\",{className:\"col-md-6\"},React.createElement(\"div\",{className:\"form-group files\"},React.createElement(\"label\",null,\"Upload your poster \"),React.createElement(\"input\",{type:\"file\",className:\"form-control\",name:\"poster\",id:\"poster\",accept:\"image/*\",ref:this.poster,required:true}))))),React.createElement(\"div\",{className:\"line\"},React.createElement(\"input\",{type:\"submit\",value:\"Submit\",id:\"submit\"}))));}}]);return NewVideo;}(React.Component);export default NewVideo;","map":{"version":3,"sources":["/home/andrew/webprogbase2/client/src/NewVideo.js"],"names":["React","axios","NewVideo","props","count","url","format","state","cloudName","unsignedUploadPreset","progress","progressText","error","message","handleSubmit","bind","video","createRef","poster","title","quality","size","file","fd","FormData","append","post","headers","onUploadProgress","e","Math","round","loaded","total","setState","then","res","console","log","data","secure_url","uploadFile","current","files","obj","value","posterUrl","videoUrl","location","query","ch","Authorization","auth","history","push","_id","catch","err","response","status","event","preventDefault","length","type","startsWith","width","Component"],"mappings":"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","sourcesContent":["import React from 'react'\nimport axios from 'axios'\nimport './css/new.css'\n\nclass NewVideo extends React.Component {\n    count = 0;\n    url = '';\n    format = '';\n  constructor(props) {\n    super(props);\n    this.state = {\n        cloudName:'hlrzutjus',\n        unsignedUploadPreset:'lzhs5xdj',\n        progress:0,\n        progressText:'',\n        error: false,\n        message:''\n    }\n    this.handleSubmit = this.handleSubmit.bind(this);\n    this.video = React.createRef();\n    this.poster = React.createRef();\n    this.title = React.createRef();\n    this.quality = React.createRef();\n    this.size = React.createRef();\n  }\n\n  uploadFile(file) {\n        this.count++;\n        let url = `https://api.cloudinary.com/v1_1/${this.state.cloudName}/upload`;\n        let fd = new FormData();\n        fd.append('file', file);\n        fd.append('upload_preset', this.state.unsignedUploadPreset);\n        if(this.count === 1) {\n            fd.append('folder', 'videos');\n        }\n        else {\n            fd.append('folder', 'posters');\n        }\n        axios.post(url, fd, {headers: {\n            'Content-Type': 'multipart/form-data'\n          },\n        onUploadProgress: (e) => {\n            let progress = Math.round((e.loaded * 100.0) / e.total);\n            if(this.count === 1) {\n                this.setState({progress: progress, progressText: progress + \"% video\"});\n            }\n            else {\n                this.setState({progress: progress, progressText: progress + \"% poster\"});\n            }\n        }})\n        .then(res => {\n            if(this.count === 1) {\n                console.log(res.data);\n                this.url = res.data.secure_url;\n                this.format = res.data.format;\n                this.uploadFile(this.poster.current.files[0]);\n                return false;\n            }\n            else {\n                let obj = {title: this.title.current.value};\n                obj.posterUrl = res.data.secure_url;\n                obj.format = this.format;\n                obj.size = this.size.current.value;\n                obj.quality = this.quality.current.value;\n                obj.videoUrl = this.url;\n                if(this.props.location.query) {\n                  obj.ch = this.props.location.query.ch;\n              }\n                return axios.post('/api/v1/videos', obj, {headers:{Authorization: `Bearer ${this.props.auth}`}})\n            }\n        })\n        .then(res => {\n            if(res) {\n                this.props.history.push('/videos/' + res.data._id);\n            }\n        })\n        .catch(err => {\n          if(err.response) {\n            if(err.response.status === 401) return this.props.history.push('/401')\n            else if(err.response.status === 403) return this.props.history.push('/403')\n            else if(err.response.status === 404) return this.props.history.push('/404')\n        }\n        console.error(err);\n        });    \n    }\n\n  handleSubmit(event) {\n    event.preventDefault();\n    if (this.title.current.value === '' || this.size.current.value === '' || this.quality.current.value === '' || !this.video.current.files[0] || !this.poster.current.files[0]) {\n        this.setState({error: true, message:'Please fill all fields'});\n    }\n    else if(this.title.current.value.length > 50) {\n        this.setState({error: true, message:'Too long title'});\n    }\n    else if(!this.video.current.files[0].type.startsWith(\"video/\") || !this.poster.current.files[0].type.startsWith(\"image/\")) {\n        this.setState({error: true, message:'Wrong file type'});\n    }\n    else {\n        this.uploadFile(this.video.current.files[0]);\n    }\n  }\n\n  componentWillUnmount() {\n      this.count = 0;\n      this.url = '';\n      this.format = '';\n  }\n\n  render() {\n    if(!this.props.auth) this.props.history.push('/401');\n      const progress = this.state.progress !== 0;\n    return (\n      <div className=\"New\">\n          {this.state.error && \n            <div className=\"alert alert-danger\" id=\"alert\">{this.state.message}</div>\n          }\n        <form action=\"/videos/new\" method=\"POST\" encType=\"multipart/form-data\" id='form' onSubmit={this.handleSubmit}>\n          <div className=\"line\">\n            <div className=\"col-25\">\n              <label htmlFor=\"title\">Title:</label>\n            </div>\n            <div className=\"col-75\">\n              <input type=\"text\" id=\"title\" name=\"title\" placeholder=\"Title..\" ref={this.title} required />\n            </div>\n          </div>\n          <div className=\"line\">\n            <div className=\"col-25\">\n              <label htmlFor=\"quality\">Quality:</label>\n            </div>\n            <div className=\"col-75\">\n                <input type=\"number\" name=\"quality\" min=\"0\" ref={this.quality} id=\"quality\" />\n            </div>\n          </div>\n          <div className=\"line\">\n              <div className=\"col-25\">\n                <label htmlFor=\"size\">Size:</label>\n              </div>\n              <div className=\"col-75\">\n                  <input type=\"number\" name=\"size\" min=\"0\" ref={this.size} id=\"size\" />\n              </div>\n            </div>\n          {progress &&\n            <div className=\"progress\">\n                <div id=\"progress\" className=\"progress-bar progress-bar-success progress-bar-striped\" role=\"progressbar\" aria-valuenow={this.state.progress} aria-valuemin=\"0\" aria-valuemax=\"100\" style={{width:this.state.progress + '%'}}>\n                    {this.state.progressText}\n                </div>\n            </div>\n          }\n          <div className=\"line\">\n            <div className=\"col-50\">\n                  <div className=\"col-md-6\">\n                      <div className=\"form-group files\">\n                          <label>Upload your video </label>\n                        <input type=\"file\" className=\"form-control\" name=\"video\" id=\"video\" accept=\"video/*\" ref={this.video} required />\n                      </div>   \n                  </div>\n            </div>\n            <div className=\"col-50\">\n                      <div className=\"col-md-6\">\n                          <div className=\"form-group files\">\n                              <label>Upload your poster </label>\n                            <input type=\"file\" className=\"form-control\" name=\"poster\" id=\"poster\" accept=\"image/*\" ref={this.poster} required />\n                          </div>   \n                      </div>\n            </div>\n          </div>\n          <div className=\"line\">\n            <input type=\"submit\" value=\"Submit\" id=\"submit\" />\n          </div>\n        </form>\n      </div>\n    );\n  }\n}\n\nexport default NewVideo"]},"metadata":{},"sourceType":"module"}