{"ast":null,"code":"import _classCallCheck from\"/home/andrew/webprogbase2/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/andrew/webprogbase2/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"/home/andrew/webprogbase2/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"/home/andrew/webprogbase2/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _assertThisInitialized from\"/home/andrew/webprogbase2/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"/home/andrew/webprogbase2/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import React from'react';import axios from'axios';import'./css/new.css';var NewChannel=/*#__PURE__*/function(_React$Component){_inherits(NewChannel,_React$Component);function NewChannel(props){var _this;_classCallCheck(this,NewChannel);_this=_possibleConstructorReturn(this,_getPrototypeOf(NewChannel).call(this,props));_this.state={cloudName:'hlrzutjus',unsignedUploadPreset:'lzhs5xdj',progress:0,progressText:'',error:false,message:''};_this.handleSubmit=_this.handleSubmit.bind(_assertThisInitialized(_this));_this.img=React.createRef();_this.title=React.createRef();return _this;}_createClass(NewChannel,[{key:\"uploadFile\",value:function uploadFile(file){var _this2=this;var url=\"https://api.cloudinary.com/v1_1/\".concat(this.state.cloudName,\"/upload\");var fd=new FormData();fd.append('file',file);fd.append('upload_preset',this.state.unsignedUploadPreset);fd.append('folder','chimg');axios.post(url,fd,{headers:{'Content-Type':'multipart/form-data'},onUploadProgress:function onUploadProgress(e){var progress=Math.round(e.loaded*100.0/e.total);_this2.setState({progress:progress,progressText:progress});}}).then(function(res){var obj={title:_this2.title.current.value};obj.chimgUrl=res.data.secure_url;return axios.post('/api/v1/channels',obj,{headers:{Authorization:\"Bearer \".concat(_this2.props.auth)}});}).then(function(res){if(res){_this2.props.history.push('/channels/'+res.data._id);}}).catch(function(err){if(err.response){if(err.response.status===401)return _this2.props.history.push('/401');else if(err.response.status===403)return _this2.props.history.push('/403');else if(err.response.status===404)return _this2.props.history.push('/404');}console.error(err);});}},{key:\"handleSubmit\",value:function handleSubmit(event){event.preventDefault();if(this.title.current.value===''){this.setState({error:true,message:'Please fill all fields'});}else if(this.title.current.value.length>50){this.setState({error:true,message:'Too long title'});}else if(!this.img.current.files[0].type.startsWith(\"image/\")){this.setState({error:true,message:'Wrong file type'});}else{this.uploadFile(this.img.current.files[0]);}}},{key:\"render\",value:function render(){if(!this.props.auth)this.props.history.push('/401');var progress=this.state.progress!==0;return React.createElement(\"div\",{className:\"New\"},this.state.error&&React.createElement(\"div\",{className:\"alert alert-danger\",id:\"alert\"},this.state.message),React.createElement(\"form\",{action:\"/channels/new\",method:\"POST\",encType:\"multipart/form-data\",id:\"form\",onSubmit:this.handleSubmit},React.createElement(\"div\",{className:\"line\"},React.createElement(\"div\",{className:\"col-25\"},React.createElement(\"label\",{htmlFor:\"title\"},\"Title:\")),React.createElement(\"div\",{className:\"col-75\"},React.createElement(\"input\",{type:\"text\",id:\"title\",name:\"title\",placeholder:\"Title..\",ref:this.title,required:true}))),progress&&React.createElement(\"div\",{className:\"progress\"},React.createElement(\"div\",{id:\"progress\",className:\"progress-bar progress-bar-success progress-bar-striped\",role:\"progressbar\",\"aria-valuenow\":this.state.progress,\"aria-valuemin\":\"0\",\"aria-valuemax\":\"100\",style:{width:this.state.progress+'%'}},this.state.progressText)),React.createElement(\"div\",{className:\"line\"},React.createElement(\"div\",{className:\"col-25\"},React.createElement(\"label\",{htmlFor:\"img\"},\"Channel image:\")),React.createElement(\"div\",{className:\"col-75\"},React.createElement(\"div\",{className:\"col-md-6\"},React.createElement(\"div\",{className:\"form-group files\"},React.createElement(\"input\",{type:\"file\",className:\"form-control\",name:\"chimg\",id:\"img\",ref:this.img,accept:\"image/*\",required:true}))))),React.createElement(\"div\",{className:\"line\"},React.createElement(\"input\",{type:\"submit\",value:\"Submit\",id:\"submit\"}))));}}]);return NewChannel;}(React.Component);export default NewChannel;","map":{"version":3,"sources":["/home/andrew/webprogbase2/client/src/NewChannel.js"],"names":["React","axios","NewChannel","props","state","cloudName","unsignedUploadPreset","progress","progressText","error","message","handleSubmit","bind","img","createRef","title","file","url","fd","FormData","append","post","headers","onUploadProgress","e","Math","round","loaded","total","setState","then","res","obj","current","value","chimgUrl","data","secure_url","Authorization","auth","history","push","_id","catch","err","response","status","console","event","preventDefault","length","files","type","startsWith","uploadFile","width","Component"],"mappings":"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","sourcesContent":["import React from 'react'\nimport axios from 'axios'\nimport './css/new.css'\n\nclass NewChannel extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n        cloudName:'hlrzutjus',\n        unsignedUploadPreset:'lzhs5xdj',\n        progress:0,\n        progressText:'',\n        error: false,\n        message:''\n    }\n    this.handleSubmit = this.handleSubmit.bind(this);\n    this.img = React.createRef();\n    this.title = React.createRef();\n  }\n\n  uploadFile(file) {\n        let url = `https://api.cloudinary.com/v1_1/${this.state.cloudName}/upload`;\n        let fd = new FormData();\n        fd.append('file', file);\n        fd.append('upload_preset', this.state.unsignedUploadPreset);\n        fd.append('folder', 'chimg');\n        axios.post(url, fd, {headers: {\n            'Content-Type': 'multipart/form-data'\n          },\n        onUploadProgress: (e) => {\n            let progress = Math.round((e.loaded * 100.0) / e.total);\n            this.setState({progress: progress, progressText: progress});\n        }})\n        .then(res => {\n            let obj = {title: this.title.current.value};\n            obj.chimgUrl = res.data.secure_url;\n            return axios.post('/api/v1/channels', obj, {headers:{Authorization: `Bearer ${this.props.auth}`}})\n        })\n        .then(res => {\n            if(res) {\n                this.props.history.push('/channels/' + res.data._id);\n            }\n        })\n        .catch(err => {\n          if(err.response) {\n            if(err.response.status === 401) return this.props.history.push('/401')\n            else if(err.response.status === 403) return this.props.history.push('/403')\n            else if(err.response.status === 404) return this.props.history.push('/404')\n        }\n        console.error(err);\n        });    \n    }\n\n  handleSubmit(event) {\n    event.preventDefault();\n    if (this.title.current.value === '') {\n        this.setState({error: true, message:'Please fill all fields'});\n    }\n    else if(this.title.current.value.length > 50) {\n        this.setState({error: true, message:'Too long title'});\n    }\n    else if(!this.img.current.files[0].type.startsWith(\"image/\")) {\n        this.setState({error: true, message:'Wrong file type'});\n    }\n    else {\n        this.uploadFile(this.img.current.files[0]);\n    }\n  }\n\n  render() {\n    if(!this.props.auth) this.props.history.push('/401');\n      const progress = this.state.progress !== 0;\n    return (\n      <div className=\"New\">\n          {this.state.error && \n            <div className=\"alert alert-danger\" id=\"alert\">{this.state.message}</div>\n          }\n        <form action=\"/channels/new\" method=\"POST\" encType=\"multipart/form-data\" id='form' onSubmit={this.handleSubmit}>\n          <div className=\"line\">\n            <div className=\"col-25\">\n              <label htmlFor=\"title\">Title:</label>\n            </div>\n            <div className=\"col-75\">\n              <input type=\"text\" id=\"title\" name=\"title\" placeholder=\"Title..\" ref={this.title} required />\n            </div>\n          </div>\n          {progress &&\n            <div className=\"progress\">\n                <div id=\"progress\" className=\"progress-bar progress-bar-success progress-bar-striped\" role=\"progressbar\" aria-valuenow={this.state.progress} aria-valuemin=\"0\" aria-valuemax=\"100\" style={{width:this.state.progress + '%'}}>\n                    {this.state.progressText}\n                </div>\n            </div>\n          }\n          <div className=\"line\">\n            <div className=\"col-25\">\n              <label htmlFor=\"img\">Channel image:</label>\n            </div>\n            <div className=\"col-75\">\n                <div className=\"col-md-6\">\n                    <div className=\"form-group files\">\n                      <input type=\"file\" className=\"form-control\" name=\"chimg\" id=\"img\" ref={this.img} accept=\"image/*\" required/>\n                    </div>   \n                </div>\n            </div>\n          </div>\n          <div className=\"line\">\n            <input type=\"submit\" value=\"Submit\" id=\"submit\" />\n          </div>\n        </form>\n      </div>\n    );\n  }\n}\n\nexport default NewChannel"]},"metadata":{},"sourceType":"module"}